set -e

ROOT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )/.." && pwd )"
SCRIPT_DIR="${ROOT_DIR}/script"
source $SCRIPT_DIR/functions.sh

function run_repos_one_by_one {
  local rspec_bin=$ROOT_DIR/bin/rspec

  echo "Running each repo file, one-by-one..."

  for folder in `ls -d rspec-*`; do
    echo "Running $folder"
    pushd $folder

      # rspec-core needs to run with a special script that loads simplecov first,
      # so that it can instrument rspec-core's code before rspec-core has been loaded.
      if [ -f script/rspec_with_simplecov ] && is_mri; then
        script/rspec_with_simplecov --format progress
      else
        $rspec_bin --format progress
      fi;

    popd
  done
}

run_repos_one_by_one
